<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>com.r3.conclave.mail</title>
<link href="../../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../";</script><script type="text/javascript" src="../../scripts/sourceset_dependencies.js" async="async"></script><link href="../../styles/style.css" rel="Stylesheet"><link href="../../styles/logo-styles.css" rel="Stylesheet"><link href="../../styles/jetbrains-mono.css" rel="Stylesheet"><link href="../../styles/main.css" rel="Stylesheet"><script type="text/javascript" src="../../scripts/clipboard.js" async="async"></script><script type="text/javascript" src="../../scripts/navigation-loader.js" async="async"></script><script type="text/javascript" src="../../scripts/platform-content-handler.js" async="async"></script><script type="text/javascript" src="../../scripts/main.js" async="async"></script><link href="../../images/docs_logo.svg"><link href="../../images/arrow_down.svg">  </head>
  <body>
    <div id="container">
      <div id="leftColumn"><a href="../../index.html">
          <div id="logo"></div>
        </a>
        <div id="paneSearch"></div>
        <div id="sideMenu"></div>
      </div>
      <div id="main">
        <div id="leftToggler"><span class="icon-toggler"></span></div>
<script type="text/javascript" src="../../scripts/main.js"></script>        <div class="main-content" id="content" pageIds="Conclave 1.1::com.r3.conclave.mail////PointingToDeclaration//-654294413">
          <div class="navigation-wrapper" id="navigation-wrapper">
            <div class="breadcrumbs"><a href="../../index.html">Conclave 1.1</a>/<a href="index.html">com.r3.conclave.mail</a></div>
            <div class="pull-right d-flex">
              <div id="searchBar"></div>
            </div>
          </div>
          <div class="cover ">
            <h1 class="cover"><span>Package com.</span><wbr></wbr><span>r3.</span><wbr></wbr><span>conclave.</span><wbr></wbr><span>mail</span></h1>
          </div>
          <div class="tabbedcontent">
            <div class="tabs-section" tabs-section="tabs-section"><button class="section-tab" data-active="" data-togglable="Types">Types</button></div>
            <div class="tabs-section-body">
              <h2 class="">Types</h2>
              <div class="table" data-togglable="Types"><a data-name="-310667365%2FClasslikes%2F-654294413" anchor-label="Curve25519PrivateKey" id="-310667365%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-curve25519-private-key/index.html">Curve25519PrivateKey</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-310667365%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public class <a href="-curve25519-private-key/index.html">Curve25519PrivateKey</a> implements <a href="https://docs.oracle.com/javase/8/docs/api/java/security/PrivateKey.html">PrivateKey</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="-310667365%2FClasslikes%2F-654294413" anchor-label="Curve25519PrivateKey" id="-310667365%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="-310667365%2FClasslikes%2F-654294413" anchor-label="Curve25519PrivateKey" id="-310667365%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">JCA type wrapper for Curve 25519 private keys. This is equivalent to XECPrivateKey in Java 11, but using byte arrays instead of BigInteger.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="-248373451%2FClasslikes%2F-654294413" anchor-label="Curve25519PublicKey" id="-248373451%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-curve25519-public-key/index.html">Curve25519PublicKey</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-248373451%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public class <a href="-curve25519-public-key/index.html">Curve25519PublicKey</a> implements <a href="https://docs.oracle.com/javase/8/docs/api/java/security/PublicKey.html">PublicKey</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="-248373451%2FClasslikes%2F-654294413" anchor-label="Curve25519PublicKey" id="-248373451%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="-248373451%2FClasslikes%2F-654294413" anchor-label="Curve25519PublicKey" id="-248373451%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">JCA type wrapper for Curve 25519 public keys. This is equivalent to XECPublicKey in Java 11, but using byte arrays instead of BigInteger.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="1689314027%2FClasslikes%2F-654294413" anchor-label="EnclaveMail" id="1689314027%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-enclave-mail/index.html">EnclaveMail</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1689314027%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public interface <a href="-enclave-mail/index.html">EnclaveMail</a> implements <a href="-enclave-mail-header/index.html">EnclaveMailHeader</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="1689314027%2FClasslikes%2F-654294413" anchor-label="EnclaveMail" id="1689314027%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="1689314027%2FClasslikes%2F-654294413" anchor-label="EnclaveMail" id="1689314027%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">The decrypted version of an encrypted message sent from a client to an enclave.</p><p class="paragraph">Implementations may decode raw bytes on demand, or may represent mail that isn't encoded yet.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="1579552094%2FClasslikes%2F-654294413" anchor-label="EnclaveMailHeader" id="1579552094%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-enclave-mail-header/index.html">EnclaveMailHeader</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1579552094%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public interface <a href="-enclave-mail-header/index.html">EnclaveMailHeader</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="1579552094%2FClasslikes%2F-654294413" anchor-label="EnclaveMailHeader" id="1579552094%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="1579552094%2FClasslikes%2F-654294413" anchor-label="EnclaveMailHeader" id="1579552094%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">Access to the headers on a mail.</p><p class="paragraph">The data isn't signed, it's authenticated data provided to the AES/GCM algorithm. This means it's tamperproof only to the holder of the receiving private key, not anyone else.</p><p class="paragraph">Therefore the data may be authenticated or unauthenticated, depending on how you obtained this object. If the mail was delivered into the enclave then the headers were checked, and thus can be treated as authentic (not tampered with by the host).</p><p class="paragraph">From the host you can read this data using <a href="-mail/get-unauthenticated-header.html">Mail.getUnauthenticatedHeader</a> but you have no guarantee it wasn't tampered with in transmission from the client, unless the path between the client and host is protected by another layer of encryption/authentication, such as TLS. For this reason we recommend that mail is always sent over an encrypted channel between client and host, even though mail is itself also encrypted i.e. there are two layers, one for protecting client&lt;-&gt;host and one for protecting client&lt;-&gt;enclave. TLS isn't used directly into the enclave for reasons discussed further in the documentation.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="500473483%2FClasslikes%2F-654294413" anchor-label="Mail" id="500473483%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-mail/index.html">Mail</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="500473483%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public class <a href="-mail/index.html">Mail</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="500473483%2FClasslikes%2F-654294413" anchor-label="Mail" id="500473483%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="500473483%2FClasslikes%2F-654294413" anchor-label="Mail" id="500473483%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">Access to mail utilities. To encrypt mail, use <a href="-post-office/index.html">PostOffice</a>.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="1160919611%2FClasslikes%2F-654294413" anchor-label="MinSizePolicy" id="1160919611%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-min-size-policy/index.html">MinSizePolicy</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1160919611%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public interface <a href="-min-size-policy/index.html">MinSizePolicy</a><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="1160919611%2FClasslikes%2F-654294413" anchor-label="MinSizePolicy" id="1160919611%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="1160919611%2FClasslikes%2F-654294413" anchor-label="MinSizePolicy" id="1160919611%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">A minimum size policy object that specifies what the minimum size of mail messages should be, possibly taking into account the size of mail previously seen. The encrypted bytes will be padded to be at least the size returned by <a href="-min-size-policy/get-min-size.html">getMinSize</a>. This attempts to close a message size side channel that could give away hints about the mail content.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
<a data-name="-244299866%2FClasslikes%2F-654294413" anchor-label="PostOffice" id="-244299866%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a>
                <div class="table-row" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave">
                  <div class="main-subrow keyValue ">
                    <div class=""><span class="inline-flex"><a href="-post-office/index.html">PostOffice</a><span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-244299866%2FClasslikes%2F-654294413"></span>
                          <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                        </span></span></div>
                    <div>
                      <div class="title"><div class="divergent-group" data-filterable-current=":dokkaHtml/conclave" data-filterable-set=":dokkaHtml/conclave"><div class="with-platform-tags"><span class="pull-right"></span></div>

  <div>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-depenent-content" data-active="" data-togglable=":dokkaHtml/conclave"><div class="symbol monospace">public abstract class <a href="-post-office/index.html">PostOffice</a> extends <span data-unresolved-link="com.r3.conclave.mail.internal/AbstractPostOffice///PointingToDeclaration/">AbstractPostOffice</span><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div></div></div>
  </div>
<a data-name="-244299866%2FClasslikes%2F-654294413" anchor-label="PostOffice" id="-244299866%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><div class="brief "><a data-name="-244299866%2FClasslikes%2F-654294413" anchor-label="PostOffice" id="-244299866%2FClasslikes%2F-654294413" data-filterable-set=":dokkaHtml/conclave"></a><p class="paragraph">A post office is an object for creating a stream of related mail encrypted to a <a href="-post-office/index.html#-316714031%2FProperties%2F-654294413">destinationPublicKey</a>.</p><p class="paragraph">Related mail form an ordered list on the same <a href="-post-office/index.html#939180818%2FProperties%2F-654294413">topic</a>. This ordering is defined by the sequence number field in each mail header (see <span data-unresolved-link="com.r3.conclave.mail/EnclaveMailHeader/sequenceNumber/#/PointingToDeclaration/">EnclaveMailHeader.sequenceNumber</span>) and it's important the ordering is preserved for the receiving enclave.</p><p class="paragraph">A post office also requires a <a href="-post-office/index.html#1214637768%2FProperties%2F-654294413">senderPrivateKey</a>, which is used to authenticate each mail and is received by the recipient as an authenticated public key (see <span data-unresolved-link="com.r3.conclave.mail/EnclaveMail/authenticatedSender/#/PointingToDeclaration/">EnclaveMail.authenticatedSender</span>). This can be used by the recipient for user authentication but is also required if they want to reply back.</p><p class="paragraph">The sender key can either be a short-term eptherimal key which is used only once and then discarded (e.g. when the client process exits) or it can be a long-term identity key. If the later then it's important to keep track of the current sequence number (using <a href="-post-office/index.html#-180988164%2FProperties%2F-654294413">nextSequenceNumber</a>) and persit it so that in the event of a client restart the sequence number can be restored (using <a href="-post-office/set-next-sequence-number.html">setNextSequenceNumber</a>). Otherwise the it will reset to zero and since the enclave has already seen mail with the same sender key it will reject it.</p><p class="paragraph">Starting from zero, the post office applies an increasing sequence number to each mail it creates. The sequence number, along with the topic and optional envelope (which can be provided when encrypting), are authenticted to the receiving enclave. This means it can detect dropped or reordered messages and thus the ordering is preserved.</p><p class="paragraph">However for this to work, the same post office instance must be used for the same sender key and topic pair. This means there can only be one <a href="-post-office/index.html">PostOffice</a> instance per (destination, sender, topic) triple. It's up the user to make sure this is the case.</p><p class="paragraph">To make it make it more difficult for an adversary to guess the contents of the mail just by observing their sizes, the post office pads the mail to a minimum size. By default it uses a moving average of the previous mail created. This can be changed with <a href="-post-office/index.html#1049299068%2FProperties%2F-654294413">minSizePolicy</a> if that's not a sensible policy for the application.</p><p class="paragraph">The recepient of mail can decrypt using <a href="-post-office/decrypt-mail.html">decryptMail</a> on a post office instance which has the same private key. For a mail response this will be the same post office that created the original request. Inside an enclave nothing needs to be done as mail is automatically decrypted.</p><p class="paragraph">When inside an enclave instances can only be created using one of the <code>Enclave.postOffice()</code> methods, and cannot be created using <span data-unresolved-link="com.r3.conclave.mail/PostOffice.Companion/create/#java.security.PublicKey#java.security.PrivateKey#kotlin.String/PointingToDeclaration/">PostOffice.create</span> or <code>EnclaveInstanceInfo.createPostOffice()</code>. This is to ensure the enclave's private key is correctly applied as the sender.</p></div></div>
</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer"><span class="go-to-top-icon"><a href="#content"></a></span><span><a href="https://docs.conclave.net">&#60;&#60; Back to Conclave documentation</a></span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span></div>
      </div>
    </div>
  </body>
</html>

